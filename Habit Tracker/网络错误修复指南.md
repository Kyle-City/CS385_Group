# 网络错误修复指南

## 🔍 问题诊断

如果遇到 `Auth check failed: [AxiosError: Network Error]` 错误，通常是因为：

1. **IP 地址不匹配** - 前端配置的 IP 与电脑实际 IP 不一致
2. **后端服务器未运行** - 后端服务未启动或已停止
3. **防火墙阻止** - Windows 防火墙阻止了端口 3000
4. **网络问题** - 手机和电脑不在同一 Wi-Fi 网络

## ✅ 快速修复步骤

### 步骤 1: 检查后端服务器是否运行

在 PowerShell 中运行：
```powershell
netstat -ano | Select-String ":3000" | Select-String "LISTENING"
```

如果**没有输出**，说明后端未运行，需要启动：
```powershell
cd "D:\Habit Tracker\Habit Tracker\backend"
npm run dev
```

应该看到：
```
MongoDB connected
Server running on port 3000
```

### 步骤 2: 检查当前 IP 地址

在 PowerShell 中运行：
```powershell
ipconfig | findstr /i "IPv4"
```

找到主要的 IPv4 地址（通常是 `10.x.x.x` 或 `192.168.x.x`）

### 步骤 3: 更新前端配置

如果 IP 地址与配置不一致，需要更新以下文件：

1. **`frontend/services/api.js`** (第 4 行)
2. **`frontend/context/AuthContext.js`** (第 5 行)

将 IP 地址改为当前电脑的 IP，例如：
```javascript
const API_BASE_URL = 'http://10.132.100.124:3000';
```

### 步骤 4: 重启前端应用

在 Expo 终端中：
- 按 `r` 重新加载应用
- 或按 `Ctrl+C` 停止后重新启动：
```powershell
cd "D:\Habit Tracker\Habit Tracker\frontend"
npm start
```

### 步骤 5: 在手机上重新扫描二维码

- 完全关闭 Expo Go 应用
- 重新打开并扫描新的二维码

## 🧪 测试连接

### 测试 1: 在浏览器中测试后端

访问：
```
http://localhost:3000/auth/me
```

应该返回错误（因为未认证），但能说明服务器在运行。

### 测试 2: 使用 IP 地址测试

访问（使用你的 IP 地址）：
```
http://10.132.100.124:3000/auth/me
```

如果也能访问，说明网络配置正确。

## 🔧 常见问题解决

### 问题 1: 防火墙阻止连接

**解决方案**：允许端口 3000 通过防火墙

以管理员身份运行 PowerShell：
```powershell
New-NetFirewallRule -DisplayName "Node.js Server" -Direction Inbound -LocalPort 3000 -Protocol TCP -Action Allow
```

### 问题 2: 手机和电脑不在同一网络

**解决方案**：
- ✅ 确保手机和电脑连接到**同一个 Wi-Fi 网络**
- ❌ 某些公共 Wi-Fi 可能阻止设备间通信
- ❌ 公司/学校网络可能需要 VPN

### 问题 3: IP 地址经常变化

**解决方案**：
1. 每次 IP 变化时，更新前端配置文件
2. 或者考虑使用 `localhost` + 端口转发（仅适用于模拟器）

### 问题 4: 后端启动失败

**检查**：
1. MongoDB 是否运行
2. 端口 3000 是否被占用
3. 查看后端终端错误信息

## 📝 当前配置

- **后端地址**: `http://0.0.0.0:3000` (监听所有网络接口)
- **前端配置**: `http://10.132.100.124:3000` (当前主 IP)
- **端口**: 3000

## ⚠️ 重要提示

1. **IP 地址可能会变化** - 如果重新连接 Wi-Fi，IP 可能改变
2. **开发环境配置** - 当前 CORS 配置允许所有来源（仅用于开发）
3. **生产环境** - 部署时需要配置正确的域名和 HTTPS

## 🆘 仍然无法连接？

如果按照以上步骤仍然无法连接：

1. **检查后端日志** - 查看是否有错误信息
2. **检查前端控制台** - 在 Expo Go 中摇动手机，打开开发者菜单
3. **尝试其他 IP** - 如果有多个 IPv4 地址，尝试其他地址
4. **重启网络** - 断开并重新连接 Wi-Fi

